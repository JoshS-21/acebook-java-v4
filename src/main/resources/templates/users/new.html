<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Signup</title>
    <style>
        .hidden {
          display: none;
        }
    </style>
    <script>
		function showImageField(){
		  var imageView = document.getElementById('thumbnail-image');
		  var uploadWidget = document.getElementById('upload_widget');
		  var imagePreview = document.getElementById('image-preview');
		  imageView.classList.remove('hidden');
		  uploadWidget.classList.remove('hidden');
		  imagePreview.classList.remove('hidden');
    	}
    </script>
</head>
<body>
<form action="#" th:action="@{/users}" th:object="${user}" method="post">
    <p>Firstname: <input type="text" th:field="*{firstname}" /></p>
    <p>Surname: <input type="text" th:field="*{lastname}" /></p>
    <p>Email: <input type="text" th:field="*{email}" /></p>
    <p>Bio: <input type="text" th:field="*{bio}" /></p>
    <p>Username: <input type="text" th:field="*{username}" /></p>
    <p>Password: <input type="password" th:field="*{password}" /></p>
    <input type="hidden" id="profilePic" name="profilePic" th:field="*{profilePicture}"/>
    <p class="hidden" id="image-preview">
        <img th:src="thumbnail_image" id="thumbnail-image"/>
    </p>
    <button type="button" id="upload_widget" th:onclick="'showImageField()'">Upload Media</button>
    <p><input type="submit" value="Submit" id="submit"/> <input type="reset" value="Reset" /></p>
</form>

<script src="https://upload-widget.cloudinary.com/latest/global/all.js" type="text/javascript"></script>

<script type="text/javascript">

    var myWidget = cloudinary.createUploadWidget({
                cloudName: 'dk3vxa56n',
                uploadPreset: 'test_preset'}, (error, result) => {
                if (!error && result && result.event === "success") {
                    console.log('Done! Here is the image info: ', result.info);
                    document.getElementById("profilePic").value = result.info.thumbnail_url;
                    document.getElementById("thumbnail-image").src = result.info.thumbnail_url;

                }
            }
    )

    document.getElementById("upload_widget").addEventListener("click", function(){
        myWidget.open();
    }, false);

</script>
</body>
</html>