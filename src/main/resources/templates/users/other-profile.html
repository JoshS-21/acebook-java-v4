<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
	<head>
		<meta charset="UTF-8">
		<title>Other User Profile</title>
		<style>
			.hidden {
				display: none;
			}
		</style>
		<script>
			function showContentField(postId) {
				const contentField = document.getElementById('comment-content' + postId);
				const submitButton = document.getElementById('submit_button' + postId);
				const commentButton = document.getElementById('comment_button' + postId);
				contentField.classList.remove('hidden');
				submitButton.classList.remove('hidden');
				commentButton.classList.add('hidden');
			}
		</script>
		<script>
			function likePost(postId) {
			const likeCountElement = document.getElementById('like_count' + postId);
			const csrfToken = document.querySelector('input[name="_csrf"]').value;

			fetch('/posts-like', {
			method: 'POST',
			headers: {
			'Content-Type': 'application/x-www-form-urlencoded',
			'X-CSRF-TOKEN': csrfToken
			},
			body: new URLSearchParams({
			postId: postId
			})
			})
			.then(response => response.json())
			.then(data => {
			if (data.success) {
			likeCountElement.textContent = 'Likes: ' + data.newLikeCount;
			}
			})
			.catch(error => console.error('Error:', error));
			}
		</script>
	</head>
	<body>

		<header>
			<div sec:authorize="isAuthenticated()">
				<a href="/logout">Logout</a>
			</div>
			<div sec:authorize="isAnonymous()">
				<a href="/login">Login</a>
			</div>
		</header>

		<h1>User Profile</h1>

		<img id="profile-thumbnail-image"/>
		<!-- Display Profile Picture -->

		<!-- Display user information -->
		<h2>User Information</h2>
		<img id="profile-picture" th:src="${user.profilePicture}" alt="An uploaded image">
		<p>Username: <span id="username" th:text="${user.username}">Username</span></p>
		<p>First Name: <span id="firstname" th:text="${user.firstname}">First Name</span></p>
		<p>Last Name: <span id="lastname" th:text="${user.lastname}">Last Name</span></p>
		<p>Bio: <span id="bio" th:text="${user.bio}">User Bio</span></p>


		<ul th:each="post : ${posts}">
			<li class="post">
				<p id="post-content" th:text="${post.content}"></p>
				<!-- Conditionally display the image only if img_url is present -->
				<div th:if="${post.img_url != null && !post.img_url.isEmpty()}">
					<img th:src="${post.img_url}">
				</div>

				<p id="like_count" th:id="'like_count' + ${post.id}" th:text="'Likes: ' + ${post.likeCount}"></p>
				<form class="like_button" th:onsubmit="event.preventDefault(); likePost([[${post.id}]]);">
					<input type="hidden" name="postId" th:value="${post.id}"/>
					<input type="hidden" name="_csrf" th:value="${_csrf.token}" />
					<button type="submit" th:id="'like_button' + ${post.id}">Like</button>
				</form>

				<!-- Display comments associated with the post -->
				<ul class="comment">
					<li th:each="comment : ${post.comments}">
						<p id="comment-contents" th:text="${comment.content}"></p>
					</li>
				</ul>

				<form th:action="@{/users/other-profile/${username}}" method="post">
					<input type="hidden" name="postId" th:value="${post.id}"/>
					<input type="hidden" name="fromOtherProfilePage" value="true" />
					<input type="hidden" name="username" th:value="${user.username}"/>
					<p class="hidden" th:id="'comment-content' + ${post.id}">
						Content: <input th:id="'comment-input' + ${post.id}" type="text" placeholder="Write a comment..." name="content"/>
					</p>
					<button type="button" th:id="'comment_button' + ${post.id}" th:onclick="'showContentField(' + ${post.id} + ')'">Comment</button>
					<button type="submit" th:id="'submit_button' + ${post.id}" class="hidden">Comment</button>
				</form>
			</li>
		</ul>
	</body>
</html>